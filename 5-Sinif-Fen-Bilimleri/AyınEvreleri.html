<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Işık ve Gölge Oyunu: Ay'ın Evreleri</title>
    <!-- Tailwind CSS (Tasarım için) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (İkonlar için) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Özel Animasyonlar ve Ayarlar */
        body {
            touch-action: none; /* Mobilde kaydırmayı engelle */
            user-select: none; /* Metin seçimini engelle */
            background-color: #050505;
        }
        .animate-bounce-x {
            animation: bounce-x 1s infinite;
        }
        @keyframes bounce-x {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(25%); }
        }
        /* Ay Evresi Gölge Efektleri - Krater Dokusu */
        .moon-texture {
            background-color: #d1d5db; /* Baz gri renk */
            background-image: 
                radial-gradient(circle at 30% 40%, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.15) 8%, transparent 20%),
                radial-gradient(circle at 70% 20%, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.1) 5%, transparent 15%),
                radial-gradient(circle at 50% 70%, rgba(0,0,0,0.12) 0%, rgba(0,0,0,0.12) 10%, transparent 25%),
                radial-gradient(circle at 80% 60%, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.2) 4%, transparent 10%),
                radial-gradient(circle at 20% 80%, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.1) 6%, transparent 12%);
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.2);
        }
        
        /* Güneş Efekti */
        .sun-glow {
            background: radial-gradient(circle, rgba(253, 224, 71, 1) 0%, rgba(250, 204, 21, 0.8) 40%, rgba(234, 179, 8, 0) 70%);
            filter: drop-shadow(0 0 50px rgba(234, 179, 8, 0.8));
        }

        /* Yıldız Animasyonu */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle 4s infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.8); }
        }

        /* Gerçekçi Uzay Arka Planı (CSS ile) */
        .deep-space-bg {
            background-color: #020204;
            background-image: 
                radial-gradient(at 50% 100%, rgba(28, 25, 56, 0.5) 0%, transparent 50%),
                radial-gradient(at 0% 0%, rgba(28, 25, 56, 0.5) 0%, transparent 50%),
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px);
            background-size: 100% 100%, 100% 100%, 550px 550px, 350px 350px, 250px 250px;
            background-position: 0 0, 0 0, 0 0, 40px 60px, 130px 270px;
        }
    </style>
</head>
<body class="bg-gray-950 text-white font-sans overflow-hidden h-screen flex flex-col">

    <!-- GİRİŞ EKRANI (SPLASH SCREEN) -->
    <div id="splash-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center text-white transition-opacity duration-500 deep-space-bg">
        
        <!-- Nebula Efekti -->
        <div class="absolute inset-0 bg-gradient-to-br from-purple-900/20 via-transparent to-blue-900/20 pointer-events-none"></div>

        <div class="z-10 text-center max-w-lg w-full p-8 bg-slate-900/70 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl mx-4 transform transition-all animate-[fadeIn_0.5s_ease-out]">
            
            <!-- Logo -->
            <img src="https://ogrenci.e12.com.tr/logo/tr/logo.svg" alt="Logo" class="h-20 mx-auto mb-8 drop-shadow-lg">
            
            <h1 class="text-3xl font-bold text-yellow-50 mb-2 tracking-tight">Işık ve Gölge Oyunu</h1>
            <h2 class="text-xl text-blue-300 mb-8 font-medium">Ay'ın Evreleri Simülasyonu</h2>
            
            <!-- Kullanım Talimatları -->
            <div class="text-left bg-black/40 p-6 rounded-2xl border border-white/5 mb-8 space-y-4 shadow-inner">
                <!-- İkonlar Geri Getirildi -->
                <div class="flex items-start gap-4">
                    <div class="p-2 bg-yellow-500/10 rounded-lg shrink-0">
                        <i data-lucide="mouse-pointer-2" class="w-5 h-5 text-yellow-400"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-yellow-100 text-sm">Ay'ı Sürükle</h3>
                        <p class="text-xs text-gray-400 mt-1">Ay'ı yörüngesinde hareket ettirerek ışığın geliş açısını değiştir.</p>
                    </div>
                </div>

                <div class="flex items-start gap-4">
                    <div class="p-2 bg-blue-500/10 rounded-lg shrink-0">
                        <i data-lucide="eye" class="w-5 h-5 text-blue-400"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-blue-100 text-sm">Gözlemle</h3>
                        <p class="text-xs text-gray-400 mt-1">Dünya'dan bakıldığında Ay'ın evresinin nasıl değiştiğini incele.</p>
                    </div>
                </div>

                <div class="flex items-start gap-4">
                    <div class="p-2 bg-purple-500/10 rounded-lg shrink-0">
                        <i data-lucide="help-circle" class="w-5 h-5 text-purple-400"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-purple-100 text-sm">Kendini Test Et</h3>
                        <p class="text-xs text-gray-400 mt-1">Öğrendiklerini pekiştirmek için test modunu kullan.</p>
                    </div>
                </div>
            </div>
            
            <!-- Başla Butonu -->
            <button onclick="closeSplash()" class="group w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 active:scale-95 text-white font-bold rounded-xl shadow-lg shadow-purple-900/20 transition-all duration-200 flex items-center justify-center gap-3 text-lg border border-white/10">
                <span>Simülasyona Başla</span>
                <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
        
    </div>

    <!-- Header -->
    <div class="p-4 bg-slate-900 border-b border-slate-800 flex justify-between items-center shadow-md z-20 shrink-0">
        <div class="flex items-center gap-3">
            <img src="https://ogrenci.e12.com.tr/logo/tr/logo.svg" alt="Logo" class="h-8 w-auto">
            <h1 class="text-2xl font-bold text-yellow-50">Işık ve Gölge Oyunu: <span class="text-gray-400 font-normal">Ay'ın Evreleri</span></h1>
        </div>
        
        <div class="flex gap-4">
            <!-- Normal Mod Butonu -->
            <div id="normal-mode-controls">
                <button onclick="startQuiz()" class="flex items-center gap-2 bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded-lg font-semibold transition-all shadow-lg hover:shadow-purple-500/50 text-sm md:text-base">
                    <i data-lucide="help-circle" class="w-5 h-5"></i>
                    <span>Bilgini Test Et</span>
                </button>
            </div>

            <!-- Quiz Modu Kontrolleri (Başlangıçta gizli) -->
            <div id="quiz-mode-controls" class="hidden flex items-center gap-4 bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                <span class="text-sm text-gray-300">Skor: <span id="score-display" class="text-white font-bold">0 / 0</span></span>
                <button onclick="exitQuiz()" class="text-xs text-red-300 hover:text-red-100 underline">Bitir</button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col md:flex-row relative overflow-hidden">
        
        <!-- LEFT: Simulation Area (Top Down) -->
        <div id="sim-container" class="flex-1 relative bg-black overflow-hidden cursor-crosshair border-r border-slate-800 touch-none">
            
            <!-- Dynamic Stars Container -->
            <div id="stars-container" class="absolute inset-0 pointer-events-none"></div>
            
            <!-- Labels -->
            <div class="absolute top-4 left-4 text-gray-500 text-sm pointer-events-none select-none z-10">
                <p class="font-semibold text-gray-400">Kuşbakışı Görünüm (Uzaydan)</p>
                <p class="text-xs opacity-70">Ay'ı yörüngesinde sürükle!</p>
            </div>

            <!-- Enhanced Sun Visual -->
            <div class="absolute right-[-100px] top-1/2 -translate-y-1/2 w-[250px] h-[250px] rounded-full sun-glow pointer-events-none z-0 opacity-90"></div>
            <div class="absolute right-4 top-1/2 -translate-y-1/2 text-yellow-200 font-bold tracking-widest text-lg z-10 pointer-events-none [text-shadow:0_0_10px_black] opacity-80">
                GÜNEŞ
            </div>

            <!-- Light Rays -->
             <div class="absolute right-0 top-0 bottom-0 w-64 bg-gradient-to-l from-yellow-500/10 to-transparent pointer-events-none z-0"></div>

            <!-- Simulation Stage (Centered) -->
            <div class="absolute inset-0 flex items-center justify-center z-10">
                
                <!-- Orbit Path -->
                <div class="border border-dashed border-gray-700 rounded-full absolute" style="width: 240px; height: 240px;"></div>

                <!-- Earth -->
                <div class="w-16 h-16 bg-blue-600 rounded-full relative z-10 shadow-[0_0_30px_rgba(59,130,246,0.6)] flex items-center justify-center overflow-hidden">
                     <!-- Earth Continents Simulation (Simple) -->
                     <div class="absolute w-full h-full bg-blue-500 opacity-50 rounded-full"></div>
                     <div class="absolute w-8 h-4 bg-green-500 top-3 left-2 rounded-full opacity-60"></div>
                     <div class="absolute w-6 h-8 bg-green-500 bottom-2 right-4 rounded-full opacity-60"></div>
                     
                     <!-- Earth Shadow -->
                     <div class="absolute inset-0 rounded-full bg-black opacity-60" style="clip-path: inset(0 50% 0 0);"></div>
                     <span class="text-[10px] relative z-20 text-white font-bold drop-shadow-md pointer-events-none">DÜNYA</span>
                </div>

                <!-- The Moon Wrapper -->
                <div id="moon-orbit-wrapper" class="absolute w-full h-full pointer-events-none flex items-center justify-center">
                    <div id="moon-dragger" 
                         class="absolute w-12 h-12 rounded-full cursor-grab active:cursor-grabbing transition-transform duration-75 ease-linear pointer-events-auto shadow-lg hover:scale-110 z-20"
                         style="transform: translate(120px, 0px);"> <!-- Başlangıç pozisyonu -->
                        
                        <!-- THE ABSOLUTE TRUTH: Moon visual -->
                        <div class="w-full h-full rounded-full overflow-hidden relative border border-gray-600 pointer-events-none bg-gray-900">
                             <!-- Dark Side (Left) -->
                             <div class="absolute left-0 top-0 w-1/2 h-full bg-black"></div>
                             <!-- Light Side (Right) -->
                             <div class="absolute right-0 top-0 w-1/2 h-full bg-yellow-100 shadow-[0_0_15px_rgba(253,224,71,0.5)]"></div>
                        </div>
                        
                        <!-- Label -->
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-gray-400 font-mono pointer-events-none">AY</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- RIGHT: View From Earth -->
        <div class="w-full md:w-96 bg-slate-900 border-l border-slate-800 p-6 flex flex-col items-center justify-center relative shrink-0 z-20 shadow-2xl">
            
            <div class="text-center mb-6">
                <h2 class="text-lg font-bold text-blue-300 flex items-center justify-center gap-2">
                    <i data-lucide="eye" size="18"></i>
                    Dünya'dan Ne Görüyoruz?
                </h2>
                <p class="text-xs text-slate-400 mt-1">Gözlemci perspektifi</p>
            </div>

            <!-- The Visual Result Area -->
            <div class="relative mb-6 min-h-[160px] flex items-center justify-center w-full">
                
                <!-- QUIZ MODUNDA GİZLİ HAL -->
                <div id="quiz-hidden-view" class="hidden w-40 h-40 rounded-full bg-slate-800 flex items-center justify-center border-2 border-dashed border-slate-600 animate-pulse">
                    <span class="text-5xl text-slate-500 font-bold">?</span>
                </div>

                <!-- GERÇEK AY GÖRÜNÜMÜ -->
                <div id="earth-view-moon" class="w-40 h-40 rounded-full bg-gray-950 relative overflow-hidden shadow-[0_0_40px_rgba(0,0,0,0.8)] border border-gray-800">
                    
                    <!-- Background (Dark Side) -->
                    <div class="absolute inset-0 bg-black"></div>

                    <!-- Right Semi-Circle -->
                    <div id="moon-right-hemi" class="absolute top-0 right-0 w-1/2 h-full bg-black"></div>
                    <!-- Left Semi-Circle -->
                    <div id="moon-left-hemi" class="absolute top-0 left-0 w-1/2 h-full bg-black"></div>
                    
                    <!-- The Terminator (Ellipse) -->
                    <div id="moon-terminator" 
                         class="absolute top-0 left-0 w-full h-full rounded-full transition-colors duration-0"
                         style="background-color: #000; transform: scaleX(1);">
                    </div>
                    
                    <!-- Texture overlay (Kraterler) -->
                    <!-- mix-blend-mode ile ışık ve gölgenin üzerine doku ekliyoruz -->
                    <div class="absolute inset-0 opacity-40 pointer-events-none moon-texture mix-blend-overlay"></div>
                    <div class="absolute inset-0 opacity-20 pointer-events-none moon-texture mix-blend-soft-light"></div>
                </div>
            </div>

            <!-- Info / Quiz Interaction -->
            <div class="w-full flex-1 flex flex-col justify-center">
                
                <!-- QUIZ INTERFACE -->
                <div id="quiz-interface" class="hidden space-y-3">
                     <p class="text-sm text-center mb-2 text-purple-300 font-medium">Bu hangi evre?</p>
                     
                     <!-- Feedback Message -->
                     <div id="quiz-feedback" class="hidden p-3 rounded-lg text-center text-sm font-bold mb-2 shadow-inner"></div>

                     <!-- Options Buttons -->
                     <div id="quiz-options" class="grid grid-cols-2 gap-2">
                         <!-- Butonlar JS ile doldurulacak -->
                     </div>
                     
                     <button id="next-question-btn" onclick="nextQuestion()" class="hidden w-full mt-4 bg-purple-600 hover:bg-purple-500 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-colors shadow-lg">
                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Sıradaki Soru
                     </button>
                </div>

                <!-- NORMAL INFO DISPLAY -->
                <div id="info-display" class="text-center p-5 bg-slate-800/50 rounded-xl border border-slate-700 transition-all backdrop-blur-sm flex flex-col gap-2">
                    <div>
                        <p class="text-gray-400 text-xs uppercase tracking-wider mb-1 font-semibold">Şu Anki Evre</p>
                        <p id="phase-name" class="text-2xl font-bold text-yellow-100 drop-shadow-sm">Yeni Ay</p>
                    </div>
                    
                    <!-- DYNAMIC DESCRIPTION BOX -->
                    <div class="border-t border-slate-700/50 pt-3 mt-1">
                        <p id="phase-desc" class="text-sm text-blue-100 leading-relaxed font-light min-h-[60px] flex items-center justify-center">
                            Ay, Dünya ile Güneş arasındadır. Ay'ın karanlık yüzü Dünya'ya dönüktür.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Educational Note (Moved Down) -->
            <div class="mt-auto pt-4">
                <div class="p-4 bg-blue-900/30 border border-blue-800/50 rounded-lg text-xs text-blue-200 leading-relaxed shadow-sm">
                    <strong class="block mb-1 text-blue-100 flex items-center gap-1"><i data-lucide="info" class="w-3 h-3"></i> İpucu:</strong>
                    Ay'ın Güneş'e bakan yüzü her zaman aydınlıktır. Evreler, aydınlık yüzün ne kadarını gördüğümüze bağlı olarak değişir.
                </div>
            </div>

        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- Değişkenler ---
        let angle = 0; // Radyan cinsinden (0 = Sağ/Güneş yönü)
        let isDragging = false;
        let quizMode = false;
        let quizHidden = false; // Cevap verirken dünya görünümünü gizler
        let score = { correct: 0, total: 0 };
        const ORBIT_RADIUS = 120;
        
        // --- GİRİŞ EKRANI FONKSİYONU ---
        function closeSplash() {
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0'; // Fade out efekti
            setTimeout(() => {
                splash.style.display = 'none'; // Ekrana dokunulamaz hale getir
            }, 500); // CSS transition süresiyle (500ms) uyumlu
        }

        // --- Faz İsimleri ve Açıklamaları ---
        const phasesList = [
            "Yeni Ay", "Hilal (Büyüyen)", "İlk Dördün", "Şişkin Ay (Büyüyen)", 
            "Dolunay", "Şişkin Ay (Küçülen)", "Son Dördün", "Hilal (Küçülen)"
        ];

        const phaseDescriptions = {
            "Yeni Ay": "Ay, Dünya ile Güneş arasındadır. Ay'ın karanlık yüzü Dünya'ya dönük olduğu için Ay'ı göremeyiz.",
            "Hilal (Büyüyen)": "Ay Güneş'ten uzaklaşmaya başlar. Sağ tarafında ince bir aydınlık (Ters C) görünür.",
            "İlk Dördün": "Ay'ın sağ yarısı aydınlık, sol yarısı karanlıktır. D harfi şeklinde görünür.",
            "Şişkin Ay (Büyüyen)": "Ay'ın aydınlık kısmı büyümeye devam eder. Dolunay'a yaklaşırken büyük kısmı aydınlıktır.",
            "Dolunay": "Dünya, Güneş ile Ay arasındadır. Ay'ın Dünya'ya bakan yüzü tamamen aydınlanır ve yuvarlak görünür.",
            "Şişkin Ay (Küçülen)": "Ay'ın sağ tarafından kararmaya başlar. Sol tarafı aydınlık kalır.",
            "Son Dördün": "Ay'ın sol yarısı aydınlık, sağ yarısı karanlıktır. Ters D harfi şeklinde görünür.",
            "Hilal (Küçülen)": "Ay Güneş'e yaklaşırken sadece sol tarafında ince bir aydınlık (C harfi) kalır.",
            "Bilinmiyor": "Ay'ı yörüngesinde hareket ettirerek evreleri keşfet!"
        };

        // --- Başlangıç ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons(); // İkonları yükle
            createStars(); // Yıldızları oluştur
            updateVisuals();
            renderQuizOptions();
        });

        // --- Yıldız Oluşturucu ---
        function createStars() {
            const container = document.getElementById('stars-container');
            const starCount = 150; // Yıldız sayısı
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Rastgele Pozisyon
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                // Rastgele Boyut (0.5px - 2.5px)
                const size = Math.random() * 2 + 0.5;
                
                // Rastgele Gecikme (Animasyon için)
                const delay = Math.random() * 5;

                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDelay = `${delay}s`;
                
                // Bazı yıldızları hafif mavimsi veya sarımsı yap
                if (Math.random() > 0.8) {
                    star.style.backgroundColor = '#bfdbfe'; // Mavi
                } else if (Math.random() > 0.9) {
                    star.style.backgroundColor = '#fef08a'; // Sarı
                }

                container.appendChild(star);
            }
        }

        // --- Mouse / Touch Eventleri ---
        const simContainer = document.getElementById('sim-container');
        const dragger = document.getElementById('moon-dragger');

        // Mouse Down
        dragger.addEventListener('mousedown', (e) => startDrag(e));
        dragger.addEventListener('touchstart', (e) => startDrag(e), {passive: false});

        // Mouse Move
        window.addEventListener('mousemove', (e) => onMove(e));
        window.addEventListener('touchmove', (e) => onMove(e), {passive: false});

        // Mouse Up
        window.addEventListener('mouseup', () => stopDrag());
        window.addEventListener('touchend', () => stopDrag());

        function startDrag(e) {
            if (quizMode && quizHidden) return; // Quiz sırasında kilitli
            isDragging = true;
            dragger.classList.add('scale-110', 'brightness-125');
            dragger.style.cursor = 'grabbing';
            updateAngleFromEvent(e);
        }

        function stopDrag() {
            isDragging = false;
            dragger.classList.remove('scale-110', 'brightness-125');
            dragger.style.cursor = 'grab';
        }

        function onMove(e) {
            if (!isDragging) return;
            e.preventDefault(); // Mobilde sayfa kaymasını engelle
            updateAngleFromEvent(e);
        }

        function updateAngleFromEvent(e) {
            // Container merkezini bul
            const rect = simContainer.getBoundingClientRect();
            // Ortası:
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            const dx = clientX - centerX;
            const dy = clientY - centerY;

            angle = Math.atan2(dy, dx);
            updateVisuals();
        }

        // --- Görsel Güncelleme Mantığı ---
        function updateVisuals() {
            // 1. Ay'ın Konumu (Kuşbakışı)
            const x = Math.cos(angle) * ORBIT_RADIUS;
            const y = Math.sin(angle) * ORBIT_RADIUS;
            dragger.style.transform = `translate(${x}px, ${y}px)`;

            // 2. Faz Adı ve Açıklaması
            const phaseName = getPhaseName(angle);
            document.getElementById('phase-name').textContent = phaseName;
            
            // Açıklamayı Güncelle
            const desc = phaseDescriptions[phaseName] || phaseDescriptions["Bilinmiyor"];
            document.getElementById('phase-desc').textContent = desc;

            // 3. Dünya Görünümü (Gerçekçi Ay)
            updateRealisticMoon(angle);
        }

        function getPhaseName(rad) {
            let deg = (rad * 180) / Math.PI;
            deg = deg % 360;
            if (deg < 0) deg += 360;

            if (deg >= 337.5 || deg < 22.5) return "Yeni Ay";
            if (deg >= 22.5 && deg < 67.5) return "Hilal (Büyüyen)";
            if (deg >= 67.5 && deg < 112.5) return "İlk Dördün";
            if (deg >= 112.5 && deg < 157.5) return "Şişkin Ay (Büyüyen)";
            if (deg >= 157.5 && deg < 202.5) return "Dolunay";
            if (deg >= 202.5 && deg < 247.5) return "Şişkin Ay (Küçülen)";
            if (deg >= 247.5 && deg < 292.5) return "Son Dördün";
            if (deg >= 292.5 && deg < 337.5) return "Hilal (Küçülen)";
            return "Bilinmiyor";
        }

        // --- 3D Ay Görünümü Mantığı (CSS Hilesi) ---
        function updateRealisticMoon(rad) {
            let deg = (rad * 180) / Math.PI;
            deg = deg % 360;
            if (deg < 0) deg += 360;

            const rightHemi = document.getElementById('moon-right-hemi');
            const leftHemi = document.getElementById('moon-left-hemi');
            const terminator = document.getElementById('moon-terminator');

            // Renkler - Daha gerçekçi tonlar
            const LIGHT_COLOR = '#f3f4f6'; // Çok açık gri/beyaz (Ay yüzeyi)
            const DARK_COLOR = '#000000';  // Zifiri karanlık
            
            const LIGHT_BASE = `background-color: ${LIGHT_COLOR}`;
            const DARK_BASE = `background-color: ${DARK_COLOR}`;

            // Mantık:
            // 0-180 (Büyüyen): Sağ taraf aydınlık.
            // 180-360 (Küçülen): Sol taraf aydınlık.

            if (deg > 0 && deg < 180) {
                // Büyüyen
                rightHemi.style = `background-color: ${LIGHT_COLOR}`;
            } else {
                rightHemi.style = `background-color: ${DARK_COLOR}`;
            }

            if (deg >= 180 && deg < 360) {
                // Küçülen
                leftHemi.style = `background-color: ${LIGHT_COLOR}`;
            } else {
                leftHemi.style = `background-color: ${DARK_COLOR}`;
            }

            // Terminatör (Eliptik Gölge)
            const isGibbous = (deg >= 90 && deg <= 270);
            terminator.style.backgroundColor = isGibbous ? LIGHT_COLOR : DARK_COLOR;
            
            // Ölçeklendirme (3D dönüş efekti)
            const scaleVal = Math.cos(rad);
            terminator.style.transform = `scaleX(${scaleVal})`;
        }

        // --- QUIZ MANTIĞI ---
        function startQuiz() {
            quizMode = true;
            score = { correct: 0, total: 0 };
            updateScoreDisplay();
            
            // UI Değişiklikleri
            document.getElementById('normal-mode-controls').classList.add('hidden');
            document.getElementById('quiz-mode-controls').classList.remove('hidden');
            document.getElementById('info-display').classList.add('hidden');
            document.getElementById('quiz-interface').classList.remove('hidden');
            
            nextQuestion();
        }

        function exitQuiz() {
            quizMode = false;
            quizHidden = false;
            
            // UI Değişiklikleri
            document.getElementById('normal-mode-controls').classList.remove('hidden');
            document.getElementById('quiz-mode-controls').classList.add('hidden');
            document.getElementById('info-display').classList.remove('hidden');
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('quiz-hidden-view').classList.add('hidden');
            document.getElementById('earth-view-moon').classList.remove('hidden');
            document.getElementById('quiz-feedback').classList.add('hidden');

            // Sıfırla
            angle = 0;
            updateVisuals();
        }

        function nextQuestion() {
            quizHidden = true;
            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('next-question-btn').classList.add('hidden');
            
            // Şıkları tekrar aktif et
            const buttons = document.querySelectorAll('#quiz-options button');
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.className = "text-xs p-3 rounded-lg border border-slate-600 bg-slate-800 hover:bg-slate-700 text-gray-300 transition-colors font-medium";
            });

            // Görüntüyü Gizle
            document.getElementById('quiz-hidden-view').classList.remove('hidden');
            document.getElementById('earth-view-moon').classList.add('hidden');

            // Rastgele Açı
            angle = (Math.random() * Math.PI * 2) - Math.PI;
            updateVisuals();
        }

        function checkAnswer(selectedPhase) {
            const correctPhase = getPhaseName(angle);
            const isCorrect = selectedPhase === correctPhase;
            
            score.total++;
            if (isCorrect) score.correct++;
            updateScoreDisplay();

            // Feedback Göster
            const fbBox = document.getElementById('quiz-feedback');
            fbBox.classList.remove('hidden', 'bg-green-900/50', 'text-green-200', 'bg-red-900/50', 'text-red-200', 'border', 'border-green-700', 'border-red-700');
            
            if (isCorrect) {
                fbBox.textContent = "Doğru! Harikasın.";
                fbBox.className = 'p-3 rounded-lg text-center text-sm font-bold mb-2 shadow-inner bg-green-900/50 text-green-200 border border-green-700';
            } else {
                fbBox.textContent = `Yanlış. Doğru cevap: ${correctPhase}`;
                fbBox.className = 'p-3 rounded-lg text-center text-sm font-bold mb-2 shadow-inner bg-red-900/50 text-red-200 border border-red-700';
            }

            // Görüntüyü Aç
            quizHidden = false;
            document.getElementById('quiz-hidden-view').classList.add('hidden');
            document.getElementById('earth-view-moon').classList.remove('hidden');

            // Butonları güncelle
            const buttons = document.querySelectorAll('#quiz-options button');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.innerText === correctPhase) {
                    btn.className = "text-xs p-3 rounded-lg border border-green-500 bg-green-600 text-white font-bold shadow-lg";
                } else if (btn.innerText === selectedPhase && !isCorrect) {
                    btn.className = "text-xs p-3 rounded-lg border border-red-500 bg-red-600/80 text-white opacity-70";
                } else {
                    btn.className = "text-xs p-3 rounded-lg border border-slate-700 bg-slate-900 text-gray-600 opacity-40";
                }
            });

            document.getElementById('next-question-btn').classList.remove('hidden');
        }

        function updateScoreDisplay() {
            document.getElementById('score-display').textContent = `${score.correct} / ${score.total}`;
        }

        function renderQuizOptions() {
            const container = document.getElementById('quiz-options');
            container.innerHTML = '';
            phasesList.forEach(phase => {
                const btn = document.createElement('button');
                btn.textContent = phase;
                btn.className = "text-xs p-3 rounded-lg border border-slate-600 bg-slate-800 hover:bg-slate-700 text-gray-300 transition-colors font-medium";
                btn.onclick = () => checkAnswer(phase);
                container.appendChild(btn);
            });
        }

    </script>
</body>
</html>