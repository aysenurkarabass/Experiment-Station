<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IÅŸÄ±k ve GÃ¶lge Oyunu: Ay'Ä±n Evreleri</title>
    <!-- Tailwind CSS (TasarÄ±m iÃ§in) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (Ä°konlar iÃ§in) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Ã–zel Animasyonlar ve Ayarlar */
        body {
            touch-action: none; /* Mobilde kaydÄ±rmayÄ± engelle */
            user-select: none; /* Metin seÃ§imini engelle */
            background-color: #050505;
        }
        .animate-bounce-x {
            animation: bounce-x 1s infinite;
        }
        @keyframes bounce-x {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(25%); }
        }
        /* Ay Evresi GÃ¶lge Efektleri - Krater Dokusu */
        .moon-texture {
            background-color: #d1d5db; /* Baz gri renk */
            background-image: 
                radial-gradient(circle at 30% 40%, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.15) 8%, transparent 20%),
                radial-gradient(circle at 70% 20%, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.1) 5%, transparent 15%),
                radial-gradient(circle at 50% 70%, rgba(0,0,0,0.12) 0%, rgba(0,0,0,0.12) 10%, transparent 25%),
                radial-gradient(circle at 80% 60%, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.2) 4%, transparent 10%),
                radial-gradient(circle at 20% 80%, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.1) 6%, transparent 12%);
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.2);
        }
        
        /* GÃ¼neÅŸ Efekti */
        .sun-glow {
            background: radial-gradient(circle, rgba(253, 224, 71, 1) 0%, rgba(250, 204, 21, 0.8) 40%, rgba(234, 179, 8, 0) 70%);
            filter: drop-shadow(0 0 50px rgba(234, 179, 8, 0.8));
        }

        /* YÄ±ldÄ±z Animasyonu */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle 4s infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.8); }
        }

        /* GerÃ§ekÃ§i Uzay Arka PlanÄ± (CSS ile) */
        .deep-space-bg {
            background-color: #020204;
            background-image: 
                radial-gradient(at 50% 100%, rgba(28, 25, 56, 0.5) 0%, transparent 50%),
                radial-gradient(at 0% 0%, rgba(28, 25, 56, 0.5) 0%, transparent 50%),
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px);
            background-size: 100% 100%, 100% 100%, 550px 550px, 350px 350px, 250px 250px;
            background-position: 0 0, 0 0, 0 0, 40px 60px, 130px 270px;
        }
    </style>
</head>
<body class="bg-gray-950 text-white font-sans overflow-hidden h-screen flex flex-col">

    <!-- GÄ°RÄ°Åž EKRANI (SPLASH SCREEN) -->
    <div id="splash-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center text-white transition-opacity duration-500 deep-space-bg">
        
        <!-- Nebula Efekti -->
        <div class="absolute inset-0 bg-gradient-to-br from-purple-900/20 via-transparent to-blue-900/20 pointer-events-none"></div>

        <div class="z-10 text-center max-w-lg w-full p-8 bg-slate-900/70 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl mx-4 transform transition-all animate-[fadeIn_0.5s_ease-out]">
            
            <!-- Logo -->
            <img src="https://ogrenci.e12.com.tr/logo/tr/logo.svg" alt="Logo" class="h-20 mx-auto mb-8 drop-shadow-lg">
            
            <h1 class="text-3xl font-bold text-yellow-50 mb-2 tracking-tight">IÅŸÄ±k ve GÃ¶lge Oyunu</h1>
            <h2 class="text-xl text-blue-300 mb-8 font-medium">Ay'Ä±n Evreleri SimÃ¼lasyonu</h2>
            
            <!-- KullanÄ±m TalimatlarÄ± -->
            <div class="text-left bg-black/40 p-6 rounded-2xl border border-white/5 mb-8 space-y-4 shadow-inner">
                <!-- Ä°konlar Geri Getirildi -->
                <div class="flex items-start gap-4">
                    <div class="p-2 bg-yellow-500/10 rounded-lg shrink-0">
                        <i data-lucide="mouse-pointer-2" class="w-5 h-5 text-yellow-400"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-yellow-100 text-sm">Ay'Ä± SÃ¼rÃ¼kle</h3>
                        <p class="text-xs text-gray-400 mt-1">Ay'Ä± yÃ¶rÃ¼ngesinde hareket ettirerek Ä±ÅŸÄ±ÄŸÄ±n geliÅŸ aÃ§Ä±sÄ±nÄ± deÄŸiÅŸtir.</p>
                    </div>
                </div>

                <div class="flex items-start gap-4">
                    <div class="p-2 bg-blue-500/10 rounded-lg shrink-0">
                        <i data-lucide="eye" class="w-5 h-5 text-blue-400"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-blue-100 text-sm">GÃ¶zlemle</h3>
                        <p class="text-xs text-gray-400 mt-1">DÃ¼nya'dan bakÄ±ldÄ±ÄŸÄ±nda Ay'Ä±n evresinin nasÄ±l deÄŸiÅŸtiÄŸini incele.</p>
                    </div>
                </div>

                <div class="flex items-start gap-4">
                    <div class="p-2 bg-purple-500/10 rounded-lg shrink-0">
                        <i data-lucide="help-circle" class="w-5 h-5 text-purple-400"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-purple-100 text-sm">Kendini Test Et</h3>
                        <p class="text-xs text-gray-400 mt-1">Ã–ÄŸrendiklerini pekiÅŸtirmek iÃ§in test modunu kullan.</p>
                    </div>
                </div>
            </div>
            
            <!-- BaÅŸla Butonu -->
            <button onclick="closeSplash()" class="group w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 active:scale-95 text-white font-bold rounded-xl shadow-lg shadow-purple-900/20 transition-all duration-200 flex items-center justify-center gap-3 text-lg border border-white/10">
                <span>SimÃ¼lasyona BaÅŸla</span>
                <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
        
    </div>

    <!-- Header -->
    <div class="p-4 bg-slate-900 border-b border-slate-800 flex justify-between items-center shadow-md z-20 shrink-0">
        <div class="flex items-center gap-3">
            <img src="https://ogrenci.e12.com.tr/logo/tr/logo.svg" alt="Logo" class="h-8 w-auto">
            <h1 class="text-2xl font-bold text-yellow-50">IÅŸÄ±k ve GÃ¶lge Oyunu: <span class="text-gray-400 font-normal">Ay'Ä±n Evreleri</span></h1>
        </div>
        
        <div class="flex gap-4">
            <!-- Normal Mod Butonu -->
            <div id="normal-mode-controls">
                <button onclick="startQuiz()" class="flex items-center gap-2 bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded-lg font-semibold transition-all shadow-lg hover:shadow-purple-500/50 text-sm md:text-base">
                    <i data-lucide="help-circle" class="w-5 h-5"></i>
                    <span>Bilgini Test Et</span>
                </button>
            </div>

            <!-- Quiz Modu Kontrolleri (BaÅŸlangÄ±Ã§ta gizli) -->
            <div id="quiz-mode-controls" class="hidden flex items-center gap-4 bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                <span class="text-sm text-gray-300">Ä°lerleme: <span id="progress-display" class="text-white font-bold">1 / 8</span></span>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col md:flex-row relative overflow-hidden">
        
        <!-- LEFT: Simulation Area (Top Down) -->
        <div id="sim-container" class="flex-1 relative bg-black overflow-hidden cursor-crosshair border-r border-slate-800 touch-none">
            
            <!-- Dynamic Stars Container -->
            <div id="stars-container" class="absolute inset-0 pointer-events-none"></div>
            
            <!-- Labels -->
            <div class="absolute top-4 left-4 text-gray-500 text-sm pointer-events-none select-none z-10">
                <p class="font-semibold text-gray-400">KuÅŸbakÄ±ÅŸÄ± GÃ¶rÃ¼nÃ¼m (Uzaydan)</p>
                <p class="text-xs opacity-70">Ay'Ä± yÃ¶rÃ¼ngesinde sÃ¼rÃ¼kle!</p>
            </div>

            <!-- Enhanced Sun Visual -->
            <div class="absolute right-[-100px] top-1/2 -translate-y-1/2 w-[250px] h-[250px] rounded-full sun-glow pointer-events-none z-0 opacity-90"></div>
            <div class="absolute right-4 top-1/2 -translate-y-1/2 text-yellow-200 font-bold tracking-widest text-lg z-10 pointer-events-none [text-shadow:0_0_10px_black] opacity-80">
                GÃœNEÅž
            </div>

            <!-- Light Rays -->
             <div class="absolute right-0 top-0 bottom-0 w-64 bg-gradient-to-l from-yellow-500/10 to-transparent pointer-events-none z-0"></div>

            <!-- Simulation Stage (Centered) -->
            <div class="absolute inset-0 flex items-center justify-center z-10">
                
                <!-- Orbit Path -->
                <div class="border border-dashed border-gray-700 rounded-full absolute" style="width: 240px; height: 240px;"></div>

                <!-- Earth -->
                <div class="w-16 h-16 bg-blue-600 rounded-full relative z-10 shadow-[0_0_30px_rgba(59,130,246,0.6)] flex items-center justify-center overflow-hidden">
                     <!-- Earth Continents Simulation (Simple) -->
                     <div class="absolute w-full h-full bg-blue-500 opacity-50 rounded-full"></div>
                     <div class="absolute w-8 h-4 bg-green-500 top-3 left-2 rounded-full opacity-60"></div>
                     <div class="absolute w-6 h-8 bg-green-500 bottom-2 right-4 rounded-full opacity-60"></div>
                     
                     <!-- Earth Shadow -->
                     <div class="absolute inset-0 rounded-full bg-black opacity-60" style="clip-path: inset(0 50% 0 0);"></div>
                     <span class="text-[10px] relative z-20 text-white font-bold drop-shadow-md pointer-events-none">DÃœNYA</span>
                </div>

                <!-- The Moon Wrapper -->
                <div id="moon-orbit-wrapper" class="absolute w-full h-full pointer-events-none flex items-center justify-center">
                    <div id="moon-dragger" 
                         class="absolute w-12 h-12 rounded-full cursor-grab active:cursor-grabbing transition-transform duration-75 ease-linear pointer-events-auto shadow-lg hover:scale-110 z-20"
                         style="transform: translate(120px, 0px);"> <!-- BaÅŸlangÄ±Ã§ pozisyonu -->
                        
                        <!-- THE ABSOLUTE TRUTH: Moon visual -->
                        <div class="w-full h-full rounded-full overflow-hidden relative border border-gray-600 pointer-events-none bg-gray-900">
                             <!-- Dark Side (Left) -->
                             <div class="absolute left-0 top-0 w-1/2 h-full bg-black"></div>
                             <!-- Light Side (Right) -->
                             <div class="absolute right-0 top-0 w-1/2 h-full bg-yellow-100 shadow-[0_0_15px_rgba(253,224,71,0.5)]"></div>
                        </div>
                        
                        <!-- Label -->
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-gray-400 font-mono pointer-events-none">AY</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- RIGHT: View From Earth -->
        <div class="w-full md:w-96 bg-slate-900 border-l border-slate-800 p-6 flex flex-col items-center justify-center relative shrink-0 z-20 shadow-2xl">
            
            <div class="text-center mb-6">
                <h2 class="text-lg font-bold text-blue-300 flex items-center justify-center gap-2">
                    <i data-lucide="eye" size="18"></i>
                    DÃ¼nya'dan Ne GÃ¶rÃ¼yoruz?
                </h2>
                <p class="text-xs text-slate-400 mt-1">GÃ¶zlemci perspektifi</p>
            </div>

            <!-- The Visual Result Area -->
            <div class="relative mb-6 min-h-[160px] flex items-center justify-center w-full">
                
                <!-- QUIZ MODUNDA GÄ°ZLÄ° HAL -->
                <div id="quiz-hidden-view" class="hidden w-40 h-40 rounded-full bg-slate-800 flex items-center justify-center border-2 border-dashed border-slate-600 animate-pulse">
                    <span class="text-5xl text-slate-500 font-bold">?</span>
                </div>

                <!-- GERÃ‡EK AY GÃ–RÃœNÃœMÃœ -->
                <div id="earth-view-moon" class="w-40 h-40 rounded-full bg-gray-950 relative overflow-hidden shadow-[0_0_40px_rgba(0,0,0,0.8)] border border-gray-800">
                    
                    <!-- Background (Dark Side) -->
                    <div class="absolute inset-0 bg-black"></div>

                    <!-- Right Semi-Circle -->
                    <div id="moon-right-hemi" class="absolute top-0 right-0 w-1/2 h-full bg-black"></div>
                    <!-- Left Semi-Circle -->
                    <div id="moon-left-hemi" class="absolute top-0 left-0 w-1/2 h-full bg-black"></div>
                    
                    <!-- The Terminator (Ellipse) -->
                    <div id="moon-terminator" 
                         class="absolute top-0 left-0 w-full h-full rounded-full transition-colors duration-0"
                         style="background-color: #000; transform: scaleX(1);">
                    </div>
                    
                    <!-- Texture overlay (Kraterler) -->
                    <!-- mix-blend-mode ile Ä±ÅŸÄ±k ve gÃ¶lgenin Ã¼zerine doku ekliyoruz -->
                    <div class="absolute inset-0 opacity-40 pointer-events-none moon-texture mix-blend-overlay"></div>
                    <div class="absolute inset-0 opacity-20 pointer-events-none moon-texture mix-blend-soft-light"></div>
                </div>
            </div>

            <!-- Info / Quiz Interaction -->
            <div class="w-full flex-1 flex flex-col justify-center">
                
                <!-- QUIZ INTERFACE -->
                <div id="quiz-interface" class="hidden space-y-3">
                     <p class="text-sm text-center mb-2 text-purple-300 font-medium">Bu hangi evre?</p>
                     
                     <!-- Feedback Message -->
                     <div id="quiz-feedback" class="hidden p-3 rounded-lg text-center text-sm font-bold mb-2 shadow-inner"></div>

                     <!-- Options Buttons -->
                     <div id="quiz-options" class="grid grid-cols-2 gap-2">
                         <!-- Butonlar JS ile doldurulacak -->
                     </div>
                     
                     <button id="next-question-btn" onclick="nextQuestion()" class="hidden w-full mt-4 bg-purple-600 hover:bg-purple-500 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-colors shadow-lg">
                        <i data-lucide="arrow-right" class="w-4 h-4"></i> SÄ±radaki Soru
                     </button>
                </div>

                <!-- QUIZ RESULTS SCREEN -->
                <div id="quiz-results" class="hidden text-center space-y-6 w-full animate-[fadeIn_0.5s_ease-out]">
                    <div>
                        <h3 class="text-xl font-bold text-yellow-100 mb-2">Test TamamlandÄ±!</h3>
                        <div class="w-24 h-24 rounded-full bg-slate-800 border-4 border-slate-700 flex items-center justify-center mx-auto mb-4 relative">
                            <span id="final-score" class="text-4xl font-bold text-white">0</span>
                            <span class="absolute bottom-4 text-xs text-gray-400 font-bold">/ 8</span>
                        </div>
                        <p id="result-message" class="text-sm font-medium text-blue-200 px-4"></p>
                    </div>
                    
                    <div class="space-y-3">
                        <button onclick="startQuiz()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 rounded-lg font-bold text-white transition-all shadow-lg flex items-center justify-center gap-2">
                            <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Testi Tekrarla
                        </button>
                        <button onclick="exitQuiz()" class="w-full py-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-gray-300 font-medium transition-colors border border-slate-700 flex items-center justify-center gap-2">
                            <i data-lucide="home" class="w-4 h-4"></i> SimÃ¼lasyona DÃ¶n
                        </button>
                    </div>
                </div>

                <!-- NORMAL INFO DISPLAY -->
                <div id="info-display" class="text-center p-5 bg-slate-800/50 rounded-xl border border-slate-700 transition-all backdrop-blur-sm flex flex-col gap-2">
                    <div>
                        <p class="text-gray-400 text-xs uppercase tracking-wider mb-1 font-semibold">Åžu Anki Evre</p>
                        <p id="phase-name" class="text-2xl font-bold text-yellow-100 drop-shadow-sm">Yeni Ay</p>
                    </div>
                    
                    <!-- DYNAMIC DESCRIPTION BOX -->
                    <div class="border-t border-slate-700/50 pt-3 mt-1">
                        <p id="phase-desc" class="text-sm text-blue-100 leading-relaxed font-light min-h-[60px] flex items-center justify-center">
                            Ay, DÃ¼nya ile GÃ¼neÅŸ arasÄ±ndadÄ±r. Ay'Ä±n karanlÄ±k yÃ¼zÃ¼ DÃ¼nya'ya dÃ¶nÃ¼ktÃ¼r.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Educational Note (Moved Down) -->
            <div class="mt-auto pt-4">
                <div class="p-4 bg-blue-900/30 border border-blue-800/50 rounded-lg text-xs text-blue-200 leading-relaxed shadow-sm">
                    <strong class="block mb-1 text-blue-100 flex items-center gap-1"><i data-lucide="info" class="w-3 h-3"></i> Ä°pucu:</strong>
                    Ay'Ä±n GÃ¼neÅŸ'e bakan yÃ¼zÃ¼ her zaman aydÄ±nlÄ±ktÄ±r. Evreler, aydÄ±nlÄ±k yÃ¼zÃ¼n ne kadarÄ±nÄ± gÃ¶rdÃ¼ÄŸÃ¼mÃ¼ze baÄŸlÄ± olarak deÄŸiÅŸir.
                </div>
            </div>

        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DeÄŸiÅŸkenler ---
        let angle = 0; // Radyan cinsinden (0 = SaÄŸ/GÃ¼neÅŸ yÃ¶nÃ¼)
        let isDragging = false;
        let quizMode = false;
        let quizHidden = false; // Cevap verirken dÃ¼nya gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ gizler
        let score = { correct: 0, total: 0 };
        const ORBIT_RADIUS = 120;
        
        let quizQueue = []; // Sorulacak fazlarÄ±n listesi

        // --- GÄ°RÄ°Åž EKRANI FONKSÄ°YONU ---
        function closeSplash() {
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0'; // Fade out efekti
            setTimeout(() => {
                splash.style.display = 'none'; // Ekrana dokunulamaz hale getir
            }, 500); // CSS transition sÃ¼resiyle (500ms) uyumlu
        }

        // --- Faz Ä°simleri ve AÃ§Ä±klamalarÄ± ---
        const phasesList = [
            "Yeni Ay", "Hilal (BÃ¼yÃ¼yen)", "Ä°lk DÃ¶rdÃ¼n", "ÅžiÅŸkin Ay (BÃ¼yÃ¼yen)", 
            "Dolunay", "ÅžiÅŸkin Ay (KÃ¼Ã§Ã¼len)", "Son DÃ¶rdÃ¼n", "Hilal (KÃ¼Ã§Ã¼len)"
        ];

        // Sorular iÃ§in ideal aÃ§Ä± deÄŸerleri (Radyan)
        const phaseAngles = {
            "Yeni Ay": 0,
            "Hilal (BÃ¼yÃ¼yen)": 45 * (Math.PI / 180),
            "Ä°lk DÃ¶rdÃ¼n": 90 * (Math.PI / 180),
            "ÅžiÅŸkin Ay (BÃ¼yÃ¼yen)": 135 * (Math.PI / 180),
            "Dolunay": 180 * (Math.PI / 180),
            "ÅžiÅŸkin Ay (KÃ¼Ã§Ã¼len)": 225 * (Math.PI / 180),
            "Son DÃ¶rdÃ¼n": 270 * (Math.PI / 180),
            "Hilal (KÃ¼Ã§Ã¼len)": 315 * (Math.PI / 180)
        };

        const phaseDescriptions = {
            "Yeni Ay": "Ay, DÃ¼nya ile GÃ¼neÅŸ arasÄ±ndadÄ±r. Ay'Ä±n karanlÄ±k yÃ¼zÃ¼ DÃ¼nya'ya dÃ¶nÃ¼k olduÄŸu iÃ§in Ay'Ä± gÃ¶remeyiz.",
            "Hilal (BÃ¼yÃ¼yen)": "Ay GÃ¼neÅŸ'ten uzaklaÅŸmaya baÅŸlar. SaÄŸ tarafÄ±nda ince bir aydÄ±nlÄ±k (Ters C) gÃ¶rÃ¼nÃ¼r.",
            "Ä°lk DÃ¶rdÃ¼n": "Ay'Ä±n saÄŸ yarÄ±sÄ± aydÄ±nlÄ±k, sol yarÄ±sÄ± karanlÄ±ktÄ±r. D harfi ÅŸeklinde gÃ¶rÃ¼nÃ¼r.",
            "ÅžiÅŸkin Ay (BÃ¼yÃ¼yen)": "Ay'Ä±n aydÄ±nlÄ±k kÄ±smÄ± bÃ¼yÃ¼meye devam eder. Dolunay'a yaklaÅŸÄ±rken bÃ¼yÃ¼k kÄ±smÄ± aydÄ±nlÄ±ktÄ±r.",
            "Dolunay": "DÃ¼nya, GÃ¼neÅŸ ile Ay arasÄ±ndadÄ±r. Ay'Ä±n DÃ¼nya'ya bakan yÃ¼zÃ¼ tamamen aydÄ±nlanÄ±r ve yuvarlak gÃ¶rÃ¼nÃ¼r.",
            "ÅžiÅŸkin Ay (KÃ¼Ã§Ã¼len)": "Ay'Ä±n saÄŸ tarafÄ±ndan kararmaya baÅŸlar. Sol tarafÄ± aydÄ±nlÄ±k kalÄ±r.",
            "Son DÃ¶rdÃ¼n": "Ay'Ä±n sol yarÄ±sÄ± aydÄ±nlÄ±k, saÄŸ yarÄ±sÄ± karanlÄ±ktÄ±r. Ters D harfi ÅŸeklinde gÃ¶rÃ¼nÃ¼r.",
            "Hilal (KÃ¼Ã§Ã¼len)": "Ay GÃ¼neÅŸ'e yaklaÅŸÄ±rken sadece sol tarafÄ±nda ince bir aydÄ±nlÄ±k (C harfi) kalÄ±r.",
            "Bilinmiyor": "Ay'Ä± yÃ¶rÃ¼ngesinde hareket ettirerek evreleri keÅŸfet!"
        };

        // --- BaÅŸlangÄ±Ã§ ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons(); // Ä°konlarÄ± yÃ¼kle
            createStars(); // YÄ±ldÄ±zlarÄ± oluÅŸtur
            updateVisuals();
            renderQuizOptions();
        });

        // --- YÄ±ldÄ±z OluÅŸturucu ---
        function createStars() {
            const container = document.getElementById('stars-container');
            const starCount = 150; // YÄ±ldÄ±z sayÄ±sÄ±
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Rastgele Pozisyon
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                // Rastgele Boyut (0.5px - 2.5px)
                const size = Math.random() * 2 + 0.5;
                
                // Rastgele Gecikme (Animasyon iÃ§in)
                const delay = Math.random() * 5;

                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDelay = `${delay}s`;
                
                // BazÄ± yÄ±ldÄ±zlarÄ± hafif mavimsi veya sarÄ±msÄ± yap
                if (Math.random() > 0.8) {
                    star.style.backgroundColor = '#bfdbfe'; // Mavi
                } else if (Math.random() > 0.9) {
                    star.style.backgroundColor = '#fef08a'; // SarÄ±
                }

                container.appendChild(star);
            }
        }

        // --- Mouse / Touch Eventleri ---
        const simContainer = document.getElementById('sim-container');
        const dragger = document.getElementById('moon-dragger');

        // Mouse Down
        dragger.addEventListener('mousedown', (e) => startDrag(e));
        dragger.addEventListener('touchstart', (e) => startDrag(e), {passive: false});

        // Mouse Move
        window.addEventListener('mousemove', (e) => onMove(e));
        window.addEventListener('touchmove', (e) => onMove(e), {passive: false});

        // Mouse Up
        window.addEventListener('mouseup', () => stopDrag());
        window.addEventListener('touchend', () => stopDrag());

        function startDrag(e) {
            if (quizMode && quizHidden) return; // Quiz sÄ±rasÄ±nda kilitli
            isDragging = true;
            dragger.classList.add('scale-110', 'brightness-125');
            dragger.style.cursor = 'grabbing';
            updateAngleFromEvent(e);
        }

        function stopDrag() {
            isDragging = false;
            dragger.classList.remove('scale-110', 'brightness-125');
            dragger.style.cursor = 'grab';
        }

        function onMove(e) {
            if (!isDragging) return;
            e.preventDefault(); // Mobilde sayfa kaymasÄ±nÄ± engelle
            updateAngleFromEvent(e);
        }

        function updateAngleFromEvent(e) {
            // Container merkezini bul
            const rect = simContainer.getBoundingClientRect();
            // OrtasÄ±:
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            const dx = clientX - centerX;
            const dy = clientY - centerY;

            angle = Math.atan2(dy, dx);
            updateVisuals();
        }

        // --- GÃ¶rsel GÃ¼ncelleme MantÄ±ÄŸÄ± ---
        function updateVisuals() {
            // 1. Ay'Ä±n Konumu (KuÅŸbakÄ±ÅŸÄ±)
            const x = Math.cos(angle) * ORBIT_RADIUS;
            const y = Math.sin(angle) * ORBIT_RADIUS;
            dragger.style.transform = `translate(${x}px, ${y}px)`;

            // 2. Faz AdÄ± ve AÃ§Ä±klamasÄ±
            const phaseName = getPhaseName(angle);
            document.getElementById('phase-name').textContent = phaseName;
            
            // AÃ§Ä±klamayÄ± GÃ¼ncelle
            const desc = phaseDescriptions[phaseName] || phaseDescriptions["Bilinmiyor"];
            document.getElementById('phase-desc').textContent = desc;

            // 3. DÃ¼nya GÃ¶rÃ¼nÃ¼mÃ¼ (GerÃ§ekÃ§i Ay)
            updateRealisticMoon(angle);
        }

        function getPhaseName(rad) {
            let deg = (rad * 180) / Math.PI;
            deg = deg % 360;
            if (deg < 0) deg += 360;

            if (deg >= 337.5 || deg < 22.5) return "Yeni Ay";
            if (deg >= 22.5 && deg < 67.5) return "Hilal (BÃ¼yÃ¼yen)";
            if (deg >= 67.5 && deg < 112.5) return "Ä°lk DÃ¶rdÃ¼n";
            if (deg >= 112.5 && deg < 157.5) return "ÅžiÅŸkin Ay (BÃ¼yÃ¼yen)";
            if (deg >= 157.5 && deg < 202.5) return "Dolunay";
            if (deg >= 202.5 && deg < 247.5) return "ÅžiÅŸkin Ay (KÃ¼Ã§Ã¼len)";
            if (deg >= 247.5 && deg < 292.5) return "Son DÃ¶rdÃ¼n";
            if (deg >= 292.5 && deg < 337.5) return "Hilal (KÃ¼Ã§Ã¼len)";
            return "Bilinmiyor";
        }

        // --- 3D Ay GÃ¶rÃ¼nÃ¼mÃ¼ MantÄ±ÄŸÄ± (CSS Hilesi) ---
        function updateRealisticMoon(rad) {
            let deg = (rad * 180) / Math.PI;
            deg = deg % 360;
            if (deg < 0) deg += 360;

            const rightHemi = document.getElementById('moon-right-hemi');
            const leftHemi = document.getElementById('moon-left-hemi');
            const terminator = document.getElementById('moon-terminator');

            // Renkler - Daha gerÃ§ekÃ§i tonlar
            const LIGHT_COLOR = '#f3f4f6'; // Ã‡ok aÃ§Ä±k gri/beyaz (Ay yÃ¼zeyi)
            const DARK_COLOR = '#000000';  // Zifiri karanlÄ±k
            
            const LIGHT_BASE = `background-color: ${LIGHT_COLOR}`;
            const DARK_BASE = `background-color: ${DARK_COLOR}`;

            // MantÄ±k:
            // 0-180 (BÃ¼yÃ¼yen): SaÄŸ taraf aydÄ±nlÄ±k.
            // 180-360 (KÃ¼Ã§Ã¼len): Sol taraf aydÄ±nlÄ±k.

            if (deg > 0 && deg < 180) {
                // BÃ¼yÃ¼yen
                rightHemi.style = `background-color: ${LIGHT_COLOR}`;
            } else {
                rightHemi.style = `background-color: ${DARK_COLOR}`;
            }

            if (deg >= 180 && deg < 360) {
                // KÃ¼Ã§Ã¼len
                leftHemi.style = `background-color: ${LIGHT_COLOR}`;
            } else {
                leftHemi.style = `background-color: ${DARK_COLOR}`;
            }

            // TerminatÃ¶r (Eliptik GÃ¶lge)
            const isGibbous = (deg >= 90 && deg <= 270);
            terminator.style.backgroundColor = isGibbous ? LIGHT_COLOR : DARK_COLOR;
            
            // Ã–lÃ§eklendirme (3D dÃ¶nÃ¼ÅŸ efekti)
            const scaleVal = Math.cos(rad);
            terminator.style.transform = `scaleX(${scaleVal})`;
        }

        // --- QUIZ MANTIÄžI ---
        
        // KarÄ±ÅŸtÄ±rma (Shuffle) Fonksiyonu
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startQuiz() {
            quizMode = true;
            score = { correct: 0, total: 0 };
            
            // 8 evreyi listele ve karÄ±ÅŸtÄ±r
            quizQueue = shuffleArray([...phasesList]);
            
            updateScoreDisplay();
            
            // UI DeÄŸiÅŸiklikleri
            document.getElementById('normal-mode-controls').classList.add('hidden');
            document.getElementById('quiz-mode-controls').classList.remove('hidden');
            document.getElementById('info-display').classList.add('hidden');
            document.getElementById('quiz-interface').classList.remove('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            
            nextQuestion();
        }

        function showResults() {
            quizMode = false; // Drag kilidini aÃ§
            quizHidden = false;
            
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('earth-view-moon').classList.remove('hidden');
            document.getElementById('quiz-hidden-view').classList.add('hidden');

            // SonuÃ§larÄ± YazdÄ±r
            document.getElementById('final-score').textContent = score.correct;
            
            const resultMsg = document.getElementById('result-message');
            if (score.correct === 8) {
                resultMsg.textContent = "MÃ¼kemmel! Ay'Ä±n tÃ¼m evrelerine hakimsin. ðŸŽ‰";
                resultMsg.className = "text-sm font-medium text-green-300 px-4";
            } else if (score.correct >= 5) {
                resultMsg.textContent = "Tebrikler, gayet iyi! Biraz daha pratikle mÃ¼kemmel olabilirsin.";
                resultMsg.className = "text-sm font-medium text-blue-200 px-4";
            } else {
                resultMsg.textContent = "Biraz daha Ã§alÄ±ÅŸmalÄ±sÄ±n. SimÃ¼lasyonu kullanarak evreleri tekrar incele.";
                resultMsg.className = "text-sm font-medium text-yellow-200 px-4";
            }
        }

        function exitQuiz() {
            quizMode = false;
            quizHidden = false;
            
            // UI DeÄŸiÅŸiklikleri
            document.getElementById('normal-mode-controls').classList.remove('hidden');
            document.getElementById('quiz-mode-controls').classList.add('hidden');
            document.getElementById('info-display').classList.remove('hidden');
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-hidden-view').classList.add('hidden');
            document.getElementById('earth-view-moon').classList.remove('hidden');
            document.getElementById('quiz-feedback').classList.add('hidden');

            // SÄ±fÄ±rla
            angle = 0;
            updateVisuals();
        }

        function nextQuestion() {
            // EÄŸer soru kalmadÄ±ysa sonuÃ§larÄ± gÃ¶ster
            if (quizQueue.length === 0) {
                showResults();
                return;
            }

            quizHidden = true;
            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('next-question-btn').classList.add('hidden');
            
            // ÅžÄ±klarÄ± tekrar aktif et
            const buttons = document.querySelectorAll('#quiz-options button');
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.className = "text-xs p-3 rounded-lg border border-slate-600 bg-slate-800 hover:bg-slate-700 text-gray-300 transition-colors font-medium";
            });

            // GÃ¶rÃ¼ntÃ¼yÃ¼ Gizle
            document.getElementById('quiz-hidden-view').classList.remove('hidden');
            document.getElementById('earth-view-moon').classList.add('hidden');

            // SÄ±radaki FazÄ± Al (Listeden Ã§Ä±kar)
            const targetPhase = quizQueue.pop();
            
            // AÃ§Ä±yÄ± o faza ayarla
            angle = phaseAngles[targetPhase];
            
            // Soru sayÄ±sÄ±nÄ± gÃ¼ncelle
            const currentQ = 8 - quizQueue.length;
            document.getElementById('progress-display').textContent = `${currentQ} / 8`;
            
            updateVisuals();
        }

        function checkAnswer(selectedPhase) {
            const correctPhase = getPhaseName(angle);
            const isCorrect = selectedPhase === correctPhase;
            
            score.total++; // Not: Bu mantÄ±kta total her zaman 8'e gidecek, ama anlÄ±k takip iÃ§in ok.
            if (isCorrect) score.correct++;
            // Skor gÃ¶stergesini gÃ¼ncellemek gerekmiyor Ã§Ã¼nkÃ¼ sonuÃ§ ekranÄ±nda gÃ¶steriyoruz artÄ±k.

            // Feedback GÃ¶ster
            const fbBox = document.getElementById('quiz-feedback');
            fbBox.classList.remove('hidden', 'bg-green-900/50', 'text-green-200', 'bg-red-900/50', 'text-red-200', 'border', 'border-green-700', 'border-red-700');
            
            if (isCorrect) {
                fbBox.textContent = "DoÄŸru! HarikasÄ±n.";
                fbBox.className = 'p-3 rounded-lg text-center text-sm font-bold mb-2 shadow-inner bg-green-900/50 text-green-200 border border-green-700';
            } else {
                fbBox.textContent = `YanlÄ±ÅŸ. DoÄŸru cevap: ${correctPhase}`;
                fbBox.className = 'p-3 rounded-lg text-center text-sm font-bold mb-2 shadow-inner bg-red-900/50 text-red-200 border border-red-700';
            }

            // GÃ¶rÃ¼ntÃ¼yÃ¼ AÃ§
            quizHidden = false;
            document.getElementById('quiz-hidden-view').classList.add('hidden');
            document.getElementById('earth-view-moon').classList.remove('hidden');

            // ButonlarÄ± gÃ¼ncelle
            const buttons = document.querySelectorAll('#quiz-options button');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.innerText === correctPhase) {
                    btn.className = "text-xs p-3 rounded-lg border border-green-500 bg-green-600 text-white font-bold shadow-lg";
                } else if (btn.innerText === selectedPhase && !isCorrect) {
                    btn.className = "text-xs p-3 rounded-lg border border-red-500 bg-red-600/80 text-white opacity-70";
                } else {
                    btn.className = "text-xs p-3 rounded-lg border border-slate-700 bg-slate-900 text-gray-600 opacity-40";
                }
            });

            // Sonraki soru butonu veya SonuÃ§larÄ± GÃ¶r butonu
            const nextBtn = document.getElementById('next-question-btn');
            nextBtn.classList.remove('hidden');
            
            if (quizQueue.length === 0) {
                nextBtn.innerHTML = '<i data-lucide="award" class="w-4 h-4"></i> SonuÃ§larÄ± GÃ¶r';
            } else {
                nextBtn.innerHTML = '<i data-lucide="arrow-right" class="w-4 h-4"></i> SÄ±radaki Soru';
                // Lucide ikonlarÄ±nÄ± refreshlemek gerekebilir
                lucide.createIcons();
            }
        }

        function updateScoreDisplay() {
            // ArtÄ±k sonuÃ§ ekranÄ±nda gÃ¶steriyoruz, burasÄ± boÅŸ kalabilir veya Ã¼st bar iÃ§in kullanÄ±labilir.
            // document.getElementById('score-display').textContent = ...
        }

        function renderQuizOptions() {
            const container = document.getElementById('quiz-options');
            container.innerHTML = '';
            phasesList.forEach(phase => {
                const btn = document.createElement('button');
                btn.textContent = phase;
                btn.className = "text-xs p-3 rounded-lg border border-slate-600 bg-slate-800 hover:bg-slate-700 text-gray-300 transition-colors font-medium";
                btn.onclick = () => checkAnswer(phase);
                container.appendChild(btn);
            });
        }

    </script>
</body>
</html>