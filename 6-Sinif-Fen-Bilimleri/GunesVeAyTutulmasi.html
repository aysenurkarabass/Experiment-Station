<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GÃ¼neÅŸ ve Ay TutulmalarÄ± - 3B SimÃ¼lasyon</title>
    <!-- Three.js KÃ¼tÃ¼phanesi -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;600&display=swap');

        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #000; 
            font-family: 'Exo 2', sans-serif; 
        }
        
        /* UI KatmanÄ± - En Ãœstte */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* TÄ±klamalarÄ±n 3D sahneye geÃ§mesine izin ver */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 100;
        }

        /* --- GÄ°RÄ°Å MENÃœSÃœ --- */
        #menu-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #fdbb2d); 
            background: linear-gradient(to bottom, #000000, #0f2027);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            pointer-events: auto;
            transition: opacity 0.5s;
        }

        /* GiriÅŸ EkranÄ± Logosu */
        .menu-logo {
            width: 180px;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.3));
            animation: floatLogo 3s ease-in-out infinite;
        }

        @keyframes floatLogo {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            color: white;
            font-size: 3.5rem;
            text-shadow: 0 0 20px #4facfe;
            margin-bottom: 50px;
            text-align: center;
            letter-spacing: 2px;
            margin-top: 10px;
        }
        
        .card-container { display: flex; gap: 40px; flex-wrap: wrap; justify-content: center;}
        
        .menu-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 260px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .menu-card:hover { 
            transform: translateY(-15px) scale(1.05); 
            background: rgba(255,255,255,0.15); 
            border-color: #4facfe;
            box-shadow: 0 20px 50px rgba(79, 172, 254, 0.3); 
        }

        .menu-card h2 { color: #fff; margin: 15px 0; font-size: 1.8rem; }
        .menu-card p { color: #aaa; font-size: 1rem; line-height: 1.5; }

        /* YENÄ° GERÃ‡EKÃ‡Ä° Ä°KONLAR (CSS) */
        .planet-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 15px;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        /* GÃ¼neÅŸ Ä°konu */
        .sun-icon {
            background: radial-gradient(circle at 30% 30%, #fff176, #fbc02d, #e65100);
            box-shadow: 0 0 30px rgba(255, 160, 0, 0.6), inset -10px -10px 20px rgba(0,0,0,0.2);
        }
        .sun-icon::before {
            content: ''; position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px;
            border-radius: 50%; background: transparent; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); z-index: -1;
        }

        /* Ay Ä°konu */
        .moon-icon {
            background: radial-gradient(circle at 30% 30%, #e0e0e0, #bdbdbd, #616161);
            box-shadow: 0 0 15px rgba(255,255,255,0.2), inset -15px -15px 30px rgba(0,0,0,0.6);
            overflow: hidden;
        }
        .moon-icon::after, .moon-icon::before {
            content: ''; position: absolute; border-radius: 50%; background: rgba(0,0,0,0.15); box-shadow: inset 1px 1px 3px rgba(0,0,0,0.4);
        }
        .moon-icon::before { width: 20px; height: 20px; top: 25%; left: 20%; }
        .moon-icon::after { width: 30px; height: 30px; top: 50%; left: 55%; }
        .moon-crater { position: absolute; width: 10px; height: 10px; top: 65%; left: 30%; border-radius: 50%; background: rgba(0,0,0,0.15); box-shadow: inset 1px 1px 2px rgba(0,0,0,0.4); }

        /* Soru Ä°ÅŸareti Ä°konu */
        .quiz-icon {
            background: radial-gradient(circle at 30% 30%, #4facfe, #00f2fe);
            display: flex; justify-content: center; align-items: center;
            font-size: 4rem; color: white; font-weight: bold; text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }


        /* --- SÄ°MÃœLASYON BAÅLIK Ã‡UBUÄU (HEADER) --- */
        #sim-header {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(0, 0, 0, 0.85);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: none; align-items: center; justify-content: space-between;
            padding: 0 20px; box-sizing: border-box; pointer-events: auto; z-index: 102;
            backdrop-filter: blur(5px);
        }

        .header-left { display: flex; align-items: center; gap: 20px; }
        .header-logo { height: 40px; width: auto; }
        #header-title { color: #f1c40f; font-size: 1.8rem; margin: 0; text-shadow: 0 0 10px rgba(241, 196, 15, 0.3); }
        .header-right { display: flex; gap: 15px; }

        .header-btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; padding: 8px 15px; border-radius: 8px; cursor: pointer;
            font-family: inherit; font-weight: 600; transition: all 0.2s;
            display: flex; align-items: center; gap: 8px;
        }
        .header-btn:hover { background: rgba(255, 255, 255, 0.2); }
        .btn-red:hover { background: rgba(231, 76, 60, 0.8); border-color: #c0392b; }
        .btn-active { background: #f1c40f; color: #000; }

        /* --- YÃ–NERGE & Ã–ZELLÄ°KLER PANELLERÄ° --- */
        #instruction-panel, #features-panel {
            pointer-events: auto; position: absolute; top: 80px;
            background: rgba(15, 20, 30, 0.95); color: #ddd; padding: 20px;
            border-radius: 12px; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            z-index: 101; transition: all 0.3s ease-in-out; display: none;
        }
        #instruction-panel { right: 20px; border-left: 5px solid #f1c40f; transform-origin: top right; }
        #features-panel { left: 20px; border-left: 5px solid #4facfe; transform-origin: top left; font-size: 0.95rem; line-height: 1.6; }
        
        #features-list { list-style-type: none; padding: 0; margin: 0; }
        #features-list li { margin-bottom: 8px; position: relative; padding-left: 20px; }
        #features-list li::before { content: "â€¢"; color: #4facfe; font-weight: bold; position: absolute; left: 0; }
        .hidden { opacity: 0; transform: translateY(-20px) scale(0.95); pointer-events: none; }
        h3.panel-title { margin-top: 0; color: #f1c40f; border-bottom: 1px solid #444; padding-bottom: 10px; margin-bottom: 10px; }
        
        /* SimÃ¼lasyon Kontrolleri */
        #simulation-controls {
            pointer-events: auto; position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); padding: 20px 40px;
            border-radius: 50px; display: none; border: 1px solid rgba(255,255,255,0.2);
            flex-direction: column; align-items: center; gap: 10px; z-index: 101; width: auto; min-width: 300px;
        }
        .slider-group { display: flex; align-items: center; gap: 15px; }
        input[type=range] { width: 400px; cursor: pointer; accent-color: #f1c40f; }
        label { color: #f1c40f; font-weight: 600; font-size: 1.2rem; text-transform: uppercase; }
        .instruction-small { color: #ccc; font-size: 0.9rem; }
        #canvas-container { width: 100%; height: 100vh; position: fixed; top: 0; left: 0; z-index: 1; }

        /* --- ETKÄ°NLÄ°K (QUIZ) EKRANI --- */
        #quiz-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none; flex-direction: column; justify-content: center; align-items: center;
            z-index: 250; pointer-events: auto;
        }
        
        .quiz-container {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255,255,255,0.2);
            padding: 40px; border-radius: 20px; text-align: center; max-width: 800px; width: 90%;
            backdrop-filter: blur(10px);
        }

        .quiz-visual {
            display: flex; justify-content: center; align-items: center; gap: 20px;
            margin: 40px 0; background: rgba(0,0,0,0.3); padding: 30px; border-radius: 15px;
        }

        /* KÃ¼Ã§Ã¼k Ä°konlar (Quiz Ä°Ã§in) */
        .q-sun { width: 80px; height: 80px; background: radial-gradient(#ffd700, #ff8c00); border-radius: 50%; box-shadow: 0 0 20px #ff8c00; }
        .q-earth { width: 50px; height: 50px; background: radial-gradient(#4facfe, #00f2fe); border-radius: 50%; box-shadow: 0 0 10px #4facfe; }
        .q-moon { width: 20px; height: 20px; background: #ddd; border-radius: 50%; box-shadow: 0 0 5px white; }

        .quiz-options { display: flex; gap: 20px; justify-content: center; margin-bottom: 30px; }
        
        .quiz-btn {
            padding: 15px 30px; font-size: 1.2rem; cursor: pointer; border: 2px solid transparent;
            background: rgba(255,255,255,0.1); color: white; border-radius: 10px; transition: all 0.3s;
            font-family: inherit; font-weight: bold;
        }
        .quiz-btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-3px); }
        .quiz-btn.selected { border-color: #f1c40f; background: rgba(241, 196, 15, 0.2); }
        
        #check-btn {
            background: #27ae60; color: white; border: none; padding: 15px 50px; font-size: 1.3rem;
            border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        #check-btn:hover { background: #2ecc71; transform: scale(1.05); }

        #feedback-area {
            margin-top: 20px; font-size: 1.2rem; min-height: 30px; padding: 10px; border-radius: 5px;
        }
        .correct { color: #2ecc71; background: rgba(46, 204, 113, 0.2); }
        .incorrect { color: #e74c3c; background: rgba(231, 76, 60, 0.2); }
        
        #close-quiz {
            position: absolute; top: 20px; right: 20px; background: none; border: none; 
            color: #aaa; font-size: 2rem; cursor: pointer;
        }
        #close-quiz:hover { color: white; }

    </style>
</head>
<body>

    <!-- 3D Sahne -->
    <div id="canvas-container"></div>

    <!-- ArayÃ¼z KatmanÄ± -->
    <div id="ui-layer">
        
        <!-- Ana MenÃ¼ -->
        <div id="menu-screen">
            <!-- MenÃ¼ Logosu -->
            <img class="menu-logo" src="https://ogrenci.e12.com.tr/logo/tr/logo.svg" alt="e12 Logo">
            <h1>GÃ¼neÅŸ ve Ay TutulmalarÄ±</h1>
            <div class="card-container">
                <div class="menu-card" onclick="startSimulation('solar')">
                    <div class="planet-icon sun-icon"></div>
                    <h2>GÃ¼neÅŸ TutulmasÄ±</h2>
                    <p>Ay'Ä±n GÃ¼neÅŸ'i kapatarak DÃ¼nya Ã¼zerinde gÃ¶lge oluÅŸturduÄŸu anÄ± incele.</p>
                </div>
                <div class="menu-card" onclick="startSimulation('lunar')">
                    <div class="planet-icon moon-icon"><div class="moon-crater"></div></div>
                    <h2>Ay TutulmasÄ±</h2>
                    <p>DÃ¼nya'nÄ±n gÃ¶lgesinin Ay Ã¼zerine dÃ¼ÅŸÃ¼p onu kÄ±zarttÄ±ÄŸÄ± anÄ± incele.</p>
                </div>
                <!-- YENÄ° ETKÄ°NLÄ°K KARTI -->
                <div class="menu-card" onclick="openQuiz()">
                    <div class="planet-icon quiz-icon">?</div>
                    <h2>Bilgini Test Et</h2>
                    <p>GÃ¶k cisimlerinin sÄ±ralanÄ±ÅŸÄ±na bakarak hangi tutulma olduÄŸunu tahmin et.</p>
                </div>
            </div>
        </div>

        <!-- ETKÄ°NLÄ°K (QUIZ) EKRANI -->
        <div id="quiz-screen">
            <button id="close-quiz" onclick="closeQuiz()">Ã—</button>
            <div class="quiz-container">
                <h2 style="color:#f1c40f; margin-bottom:10px;">Hangi Tutulma?</h2>
                <p style="color:#ccc;">AÅŸaÄŸÄ±daki gÃ¶rselde gÃ¶k cisimlerinin sÄ±ralanÄ±ÅŸÄ±na dikkat et.</p>
                
                <!-- GÃ¶rsel AlanÄ± -->
                <div class="quiz-visual" id="quiz-visual-area">
                    <!-- JS ile doldurulacak: GÃ¼neÅŸ - Ay - DÃ¼nya vs. -->
                </div>

                <!-- SeÃ§enekler -->
                <div class="quiz-options">
                    <button class="quiz-btn" onclick="selectOption('solar')" id="btn-solar">GÃ¼neÅŸ TutulmasÄ±</button>
                    <button class="quiz-btn" onclick="selectOption('lunar')" id="btn-lunar">Ay TutulmasÄ±</button>
                </div>

                <button id="check-btn" onclick="checkAnswer()">KONTROL ET</button>
                
                <div id="feedback-area"></div>
            </div>
        </div>

        <!-- SÄ°MÃœLASYON HEADER -->
        <div id="sim-header">
            <div class="header-left">
                <img class="header-logo" src="https://ogrenci.e12.com.tr/logo/tr/logo.svg" alt="e12 Logo">
                <h2 id="header-title">Tutulma AdÄ±</h2>
            </div>
            <div class="header-right">
                <button id="btn-toggle-features" class="header-btn" onclick="toggleFeatures()"><span>ğŸ’¡</span> Ã–zellikler</button>
                <button id="btn-toggle-info" class="header-btn" onclick="toggleInstructions()"><span>ğŸ“</span> YÃ¶nerge</button>
                <button class="header-btn btn-red" onclick="goMenu()"><span>ğŸ </span> Ana MenÃ¼</button>
            </div>
        </div>
        
        <!-- PANELLER -->
        <div id="instruction-panel">
            <h3 class="panel-title">Bilgi</h3>
            <p id="info-text">SimÃ¼lasyon yÃ¼kleniyor...</p>
        </div>
        <div id="features-panel">
            <h3 class="panel-title">Bilimsel Ã–zellikler</h3>
            <ul id="features-list"></ul>
        </div>

        <!-- Kontroller -->
        <div id="simulation-controls">
            <div class="slider-group">
                <label for="timeSlider">Zaman:</label>
                <input type="range" id="timeSlider" min="0" max="100" value="0" step="0.2">
            </div>
            <span class="instruction-small">Zaman Ã§ubuÄŸundaki daireyi kaydÄ±rarak gÃ¶k cisimlerini hareket ettirin.</span>
        </div>
    </div>

<script>
    // --- TEMEL DEÄÄ°ÅKENLER ---
    let scene, camera, renderer, controls;
    let sun, earth, moon, starField, sunLight;
    let currentMode = null; 
    
    const EARTH_RADIUS = 5;
    const MOON_RADIUS = 1.35;
    const SUN_RADIUS = 12;
    
    let isInstructionOpen = true;
    let isFeaturesOpen = false;

    // --- QUIZ DEÄÄ°ÅKENLERÄ° ---
    let currentQuizType = ''; // 'solar' veya 'lunar'
    let selectedAnswer = '';

    // --- BAÅLATMA ---
    function init() {
        const container = document.getElementById('canvas-container');
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020205); 
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; 
        container.appendChild(renderer.domElement);
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; controls.dampingFactor = 0.05; controls.maxDistance = 200;
        const ambientLight = new THREE.AmbientLight(0x404040, 0.2); 
        scene.add(ambientLight);
        createStars();
        createCelestialBodies();
        animate();
        window.addEventListener('resize', onWindowResize);
        document.getElementById('timeSlider').addEventListener('input', updatePositions);
    }

    // --- TEXTURE OLUÅTURUCU ---
    function createTexture(type) {
        const canvas = document.createElement('canvas'); canvas.width = 512; canvas.height = 512;
        const ctx = canvas.getContext('2d');
        if (type === 'sun') {
            const grd = ctx.createRadialGradient(256, 256, 0, 256, 256, 256);
            grd.addColorStop(0, "#fff59d"); grd.addColorStop(0.5, "#fdd835"); grd.addColorStop(1, "#f57f17");
            ctx.fillStyle = grd; ctx.fillRect(0, 0, 512, 512);
            for(let i=0; i<300; i++) { ctx.fillStyle = `rgba(255, 140, 0, ${Math.random() * 0.3})`; ctx.beginPath(); ctx.arc(Math.random()*512, Math.random()*512, Math.random()*30, 0, Math.PI*2); ctx.fill(); }
        } else if (type === 'earth') {
            ctx.fillStyle = "#1565c0"; ctx.fillRect(0, 0, 512, 512);
            ctx.fillStyle = "#2e7d32"; for(let i=0; i<30; i++) { const x = Math.random() * 512; const y = Math.random() * 512; const r = Math.random() * 60 + 20; ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI*2); ctx.fill(); ctx.fillStyle = "rgba(121, 85, 72, 0.4)"; ctx.beginPath(); ctx.arc(x + 10, y + 10, r * 0.5, 0, Math.PI*2); ctx.fill(); ctx.fillStyle = "#2e7d32"; }
            ctx.fillStyle = "rgba(255, 255, 255, 0.3)"; for(let i=0; i<50; i++) { ctx.beginPath(); ctx.ellipse(Math.random()*512, Math.random()*512, Math.random()*60, Math.random()*15, 0, 0, Math.PI*2); ctx.fill(); }
        } else if (type === 'moon') {
            ctx.fillStyle = "#cfd8dc"; ctx.fillRect(0, 0, 512, 512);
            for(let i=0; i<150; i++) { const x = Math.random() * 512; const y = Math.random() * 512; const r = Math.random() * 15 + 2; ctx.fillStyle = "rgba(0,0,0,0.15)"; ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI*2); ctx.fill(); }
        }
        return new THREE.CanvasTexture(canvas);
    }

    // --- OBJE OLUÅTURMA ---
    function createCelestialBodies() {
        const sunGeo = new THREE.SphereGeometry(SUN_RADIUS, 64, 64); const sunTex = createTexture('sun'); const sunMat = new THREE.MeshBasicMaterial({ map: sunTex, color: 0xffffff }); sun = new THREE.Mesh(sunGeo, sunMat);
        sunLight = new THREE.PointLight(0xffffff, 2, 600); sunLight.castShadow = true; sunLight.shadow.bias = -0.00005; sunLight.shadow.mapSize.width = 4096; sunLight.shadow.mapSize.height = 4096; sun.add(sunLight); 
        const glowGeo = new THREE.SphereGeometry(SUN_RADIUS * 1.3, 32, 32); const glowMat = new THREE.MeshBasicMaterial({ color: 0xffaa00, transparent: true, opacity: 0.2, side: THREE.BackSide }); const sunGlow = new THREE.Mesh(glowGeo, glowMat); sun.add(sunGlow);
        const earthGeo = new THREE.SphereGeometry(EARTH_RADIUS, 64, 64); const earthTex = createTexture('earth'); const earthMat = new THREE.MeshStandardMaterial({ map: earthTex, roughness: 0.8, metalness: 0.1 }); earth = new THREE.Mesh(earthGeo, earthMat); earth.castShadow = true; earth.receiveShadow = true;
        const moonGeo = new THREE.SphereGeometry(MOON_RADIUS, 64, 64); const moonTex = createTexture('moon'); const moonMat = new THREE.MeshStandardMaterial({ map: moonTex, roughness: 1.0 }); moon = new THREE.Mesh(moonGeo, moonMat); moon.castShadow = true; moon.receiveShadow = true;
    }

    function createStars() {
        const geometry = new THREE.BufferGeometry(); const vertices = [];
        for (let i = 0; i < 5000; i++) { vertices.push(THREE.MathUtils.randFloatSpread(1000)); vertices.push(THREE.MathUtils.randFloatSpread(1000)); vertices.push(THREE.MathUtils.randFloatSpread(1000)); }
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3)); const material = new THREE.PointsMaterial({ color: 0xFFFFFF, size: 0.5, transparent: true, opacity: 0.8 }); starField = new THREE.Points(geometry, material); scene.add(starField);
    }

    // --- QUIZ MANTIÄI ---

    function openQuiz() {
        // Rastgele bir tutulma tipi seÃ§
        currentQuizType = Math.random() > 0.5 ? 'solar' : 'lunar';
        selectedAnswer = '';
        
        // UI SÄ±fÄ±rla
        document.getElementById('feedback-area').innerHTML = '';
        document.getElementById('feedback-area').className = '';
        document.querySelectorAll('.quiz-btn').forEach(btn => btn.classList.remove('selected'));
        
        const visualArea = document.getElementById('quiz-visual-area');
        visualArea.innerHTML = ''; // Temizle

        // GÃ¶rseli OluÅŸtur
        const sunDiv = '<div class="q-sun"></div>';
        const earthDiv = '<div class="q-earth"></div>';
        const moonDiv = '<div class="q-moon"></div>';

        if (currentQuizType === 'solar') {
            // GÃ¼neÅŸ TutulmasÄ±: GÃ¼neÅŸ - Ay - DÃ¼nya
            visualArea.innerHTML = sunDiv + moonDiv + earthDiv;
        } else {
            // Ay TutulmasÄ±: GÃ¼neÅŸ - DÃ¼nya - Ay
            visualArea.innerHTML = sunDiv + earthDiv + moonDiv;
        }

        document.getElementById('quiz-screen').style.display = 'flex';
    }

    function closeQuiz() {
        document.getElementById('quiz-screen').style.display = 'none';
    }

    function selectOption(option) {
        selectedAnswer = option;
        document.querySelectorAll('.quiz-btn').forEach(btn => btn.classList.remove('selected'));
        document.getElementById('btn-' + option).classList.add('selected');
        document.getElementById('feedback-area').innerHTML = '';
        document.getElementById('feedback-area').className = '';
    }

    function checkAnswer() {
        const feedback = document.getElementById('feedback-area');
        
        if (!selectedAnswer) {
            feedback.innerText = "LÃ¼tfen bir seÃ§enek iÅŸaretleyin.";
            feedback.style.color = "#ccc";
            return;
        }

        if (selectedAnswer === currentQuizType) {
            // DOÄRU
            feedback.innerHTML = "<b>Harika! DoÄŸru Cevap.</b> ğŸ‰<br>SÄ±ralamayÄ± doÄŸru bildin.";
            feedback.className = 'correct';
            // Yeni soru iÃ§in buton metnini deÄŸiÅŸtir veya 2 sn sonra yeni soru sor
            setTimeout(openQuiz, 2500);
        } else {
            // YANLIÅ
            let explanation = "";
            if (currentQuizType === 'solar') {
                explanation = "GÃ¶rselde Ay, GÃ¼neÅŸ ile DÃ¼nya'nÄ±n arasÄ±ndaydÄ±. Bu <b>GÃ¼neÅŸ TutulmasÄ±</b>dÄ±r.";
            } else {
                explanation = "GÃ¶rselde DÃ¼nya, GÃ¼neÅŸ ile Ay'Ä±n arasÄ±ndaydÄ±. Bu <b>Ay TutulmasÄ±</b>dÄ±r.";
            }
            feedback.innerHTML = "<b>YanlÄ±ÅŸ Cevap.</b> ğŸ˜”<br>" + explanation;
            feedback.className = 'incorrect';
        }
    }

    // --- SÄ°MÃœLASYON YÃ–NETÄ°MÄ° ---

    function startSimulation(mode) {
        currentMode = mode;
        document.getElementById('menu-screen').style.opacity = '0'; setTimeout(() => { document.getElementById('menu-screen').style.display = 'none'; }, 500);
        // MenÃ¼deki logo zaten menÃ¼ ekranÄ±yla birlikte gizlenir.
        document.getElementById('sim-header').style.display = 'flex'; document.getElementById('simulation-controls').style.display = 'flex';
        showInstructionPanel(); hideFeaturesPanel();
        document.getElementById('timeSlider').value = 0;
        scene.remove(sun); scene.remove(earth); scene.remove(moon);
        if (mode === 'solar') setupSolarEclipse(); else setupLunarEclipse();
        updatePositions();
    }

    function setupSolarEclipse() {
        document.getElementById('header-title').innerText = "GÃ¼neÅŸ TutulmasÄ± SimÃ¼lasyonu";
        document.getElementById('info-text').innerHTML = "<b>SÄ±ralama:</b> GÃ¼neÅŸ - Ay - DÃ¼nya<br><br>Ay, GÃ¼neÅŸ ile DÃ¼nya arasÄ±na girdiÄŸinde GÃ¼neÅŸ Ä±ÅŸÄ±ÄŸÄ±nÄ± engeller.<br><br>AÅŸaÄŸÄ±daki zaman Ã§ubuÄŸunu kaydÄ±rÄ±n. DÃ¼nya Ã¼zerine dÃ¼ÅŸen kÃ¼Ã§Ã¼k siyah noktayÄ± (<b>Tam GÃ¶lge</b>) gÃ¶rmek iÃ§in fare ile DÃ¼nya'ya <b>yakÄ±nlaÅŸÄ±n</b>.";
        document.getElementById('features-list').innerHTML = `<li>GÃ¼ndÃ¼z vakti gÃ¶zlemlenir.</li><li>Ay, <b>Yeni Ay</b> evresindedir.</li><li>Ay, GÃ¼neÅŸ ve DÃ¼nya'nÄ±n arasÄ±na girer.</li><li>DÃ¼nya Ã¼zerinde dar bir alandan izlenir.</li><li>KÄ±sa sÃ¼reli (birkaÃ§ dakika) gerÃ§ekleÅŸir.</li><li>GÃ¶zlÃ¼k takmadan izlemek tehlikelidir.</li>`;
        sun.position.set(-60, 0, 0); earth.position.set(20, 0, 0); scene.add(sun); scene.add(earth); scene.add(moon); camera.position.set(10, 10, 30); controls.target.set(15, 0, 0); controls.update();
    }

    function setupLunarEclipse() {
        document.getElementById('header-title').innerText = "Ay TutulmasÄ± SimÃ¼lasyonu";
        document.getElementById('info-text').innerHTML = "<b>SÄ±ralama:</b> GÃ¼neÅŸ - DÃ¼nya - Ay<br><br>AÅŸaÄŸÄ±daki zaman Ã§ubuÄŸunu kaydÄ±rÄ±n. Ay, DÃ¼nya'nÄ±n gÃ¶lgesine girdiÄŸinde atmosferden sÃ¼zÃ¼len Ä±ÅŸÄ±klar nedeniyle <b>KÄ±zÄ±l (KanlÄ±)</b> bir renk alÄ±r.";
        document.getElementById('features-list').innerHTML = `<li>Gece vakti gÃ¶zlemlenir.</li><li>Ay, <b>Dolunay</b> evresindedir.</li><li>DÃ¼nya, GÃ¼neÅŸ ve Ay'Ä±n arasÄ±na girer.</li><li>Geceyi yaÅŸayan her yerden izlenebilir.</li><li>Daha uzun sÃ¼reli (birkaÃ§ saat) gerÃ§ekleÅŸir.</li><li>Ã‡Ä±plak gÃ¶zle izlenebilir.</li>`;
        sun.position.set(-80, 0, 0); earth.position.set(0, 0, 0); scene.add(sun); scene.add(earth); scene.add(moon); camera.position.set(20, 10, 30); controls.target.set(10, 0, 0); controls.update();
    }

    function updatePositions() {
        const sliderVal = parseFloat(document.getElementById('timeSlider').value); const t = sliderVal / 100; 
        if (currentMode === 'solar') {
            const startZ = 25; const endZ = -25; const currentZ = startZ - (t * (startZ - endZ)); moon.position.set(-5, 0, currentZ); moon.material.color.setHex(0xffffff); moon.material.emissive.setHex(0x000000);
        } else if (currentMode === 'lunar') {
            const startZ = 35; const endZ = -35; const currentZ = startZ - (t * (startZ - endZ)); moon.position.set(25, 0, currentZ);
            if (Math.abs(currentZ) < 5) { moon.material.color.setHex(0xff0000); moon.material.emissive.setHex(0x550000); moon.material.emissiveIntensity = 0.5;
            } else if (Math.abs(currentZ) < 9) { moon.material.color.setHex(0xffaaaa); moon.material.emissive.setHex(0x220000); moon.material.emissiveIntensity = 0.2;
            } else { moon.material.color.setHex(0xffffff); moon.material.emissive.setHex(0x000000); moon.material.emissiveIntensity = 0; }
        }
    }

    // --- PANEL ve BUTON YÃ–NETÄ°MÄ° ---
    
    function toggleInstructions() { 
        const p = document.getElementById('instruction-panel'); 
        const btn = document.getElementById('btn-toggle-info');
        isInstructionOpen = !isInstructionOpen; 
        if(isInstructionOpen) { 
            p.style.display='block'; 
            setTimeout(()=>p.classList.remove('hidden'),10); 
            btn.classList.add('btn-active');
        } else { 
            p.classList.add('hidden'); 
            setTimeout(()=>p.style.display='none',300); 
            btn.classList.remove('btn-active');
        } 
    }
    
    function showInstructionPanel() { 
        isInstructionOpen=true; 
        const p=document.getElementById('instruction-panel'); 
        const btn = document.getElementById('btn-toggle-info');
        p.style.display='block'; 
        p.classList.remove('hidden'); 
        btn.classList.add('btn-active');
    }
    
    function toggleFeatures() { 
        const p = document.getElementById('features-panel'); 
        const btn = document.getElementById('btn-toggle-features');
        isFeaturesOpen = !isFeaturesOpen; 
        if(isFeaturesOpen) { 
            p.style.display='block'; 
            setTimeout(()=>p.classList.remove('hidden'),10); 
            btn.classList.add('btn-active');
        } else { 
            p.classList.add('hidden'); 
            setTimeout(()=>p.style.display='none',300); 
            btn.classList.remove('btn-active');
        } 
    }
    
    function hideFeaturesPanel() { 
        isFeaturesOpen=false; 
        const p=document.getElementById('features-panel'); 
        const btn = document.getElementById('btn-toggle-features');
        p.classList.add('hidden'); 
        setTimeout(()=>p.style.display='none',300); 
        btn.classList.remove('btn-active');
    }

    function goMenu() { 
        document.getElementById('menu-screen').style.display = 'flex'; 
        setTimeout(() => { document.getElementById('menu-screen').style.opacity = '1'; }, 10); 
        document.getElementById('sim-header').style.display = 'none'; 
        document.getElementById('simulation-controls').style.display = 'none'; 
        document.getElementById('instruction-panel').style.display = 'none'; 
        document.getElementById('features-panel').style.display = 'none'; 
        currentMode = null; 
    }
    
    function onWindowResize() { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }
    function animate() { requestAnimationFrame(animate); controls.update(); if (earth) earth.rotation.y += 0.001; if (moon) moon.rotation.y += 0.0005; if (sun) sun.rotation.y += 0.0002; renderer.render(scene, camera); }

    init();
</script>
</body>
</html>